

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic Usage &mdash; CLoud Application Platform 0.2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Groups shared with CLAP" href="shared_groups.html" />
    <link rel="prev" title="Basic Configuration Setup" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CLoud Application Platform
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Basic Configuration Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#node-module">Node Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#command-node-start">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">start</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-list">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-alive">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">alive</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-show">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">show</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-stop">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">stop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-pause">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">pause</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-resume">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">resume</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-connect">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">connect</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-execute">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">execute</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-node-playbook">Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">playbook</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tags-module">Tags Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#command-tag-add">Command <code class="docutils literal notranslate"><span class="pre">tag</span> <span class="pre">add</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-tag-remove">Command <code class="docutils literal notranslate"><span class="pre">tag</span> <span class="pre">remove</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#group-module">Group Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clap-s-groups-and-actions">CLAP’s groups and actions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#group-description-file">Group description file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#command-group-list">Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-group-add">Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">add</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-group-action">Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">action</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-group-remove">Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">remove</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="shared_groups.html">Groups shared with CLAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="shared_modules.html">Modules shared with CLAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CLoud Application Platform</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Basic Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-usage">
<span id="usage"></span><h1>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h1>
<p>CLAP is a platform to start, stop and manage cloud’s instances (called CLAP nodes or simply ,nodes) at different cloud providers transparently, based on configuration files. Also, it offers mechanisms to perform actions via SSH commands or Ansible playboks in single nodes or in a set of nodes in a row.
To provide this, in a modular way, CLAP provides modules to allow performing several operations. You can use <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">--help</span></code> command to list the available modules or <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">-v</span> <span class="pre">--show-all</span></code> to show all available commands that can be used.</p>
<p>The most common modules are: <code class="docutils literal notranslate"><span class="pre">node</span></code>, <code class="docutils literal notranslate"><span class="pre">tags</span></code> and <code class="docutils literal notranslate"><span class="pre">groups</span></code>.</p>
<div class="section" id="node-module">
<span id="node-section"></span><h2>Node Module<a class="headerlink" href="#node-module" title="Permalink to this headline">¶</a></h2>
<p>The node module provides mechanisms to create, manage and interact with cloud’s instances. It provides the following features:</p>
<ul class="simple">
<li><p>Start nodes based on the instance templates with the <code class="docutils literal notranslate"><span class="pre">start</span></code> command</p></li>
<li><p>Stop (terminate) already started nodes using the <code class="docutils literal notranslate"><span class="pre">stop</span></code> command</p></li>
<li><p>Pause or resume already instantiated nodes using the <code class="docutils literal notranslate"><span class="pre">pause</span></code> and <code class="docutils literal notranslate"><span class="pre">resume</span></code> commands, respectively</p></li>
<li><p>Check the status of a node (if its accessible by SSH) using the <code class="docutils literal notranslate"><span class="pre">alive</span></code> command</p></li>
<li><p>List started nodes using the <code class="docutils literal notranslate"><span class="pre">list</span></code> command</p></li>
<li><p>Execute a shell command via SSH, using the <code class="docutils literal notranslate"><span class="pre">execute</span></code> command</p></li>
<li><p>Execute an Ansible Playbook using the <code class="docutils literal notranslate"><span class="pre">playbook</span></code> command</p></li>
<li><p>Obtain a shell session (via SSH) using the <code class="docutils literal notranslate"><span class="pre">connect</span></code> command</p></li>
</ul>
<p>All these commands are detailed below.</p>
<div class="section" id="command-node-start">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">start</span></code><a class="headerlink" href="#command-node-start" title="Permalink to this headline">¶</a></h3>
<p>To launch a cloud’s instance based on an instance template, defined in the <code class="docutils literal notranslate"><span class="pre">~/.clap/configs/instances.yaml</span></code> file, you can use the command below, where the <code class="docutils literal notranslate"><span class="pre">ubuntu-instance-aws</span></code> refers to the instance template ID defined in the <code class="docutils literal notranslate"><span class="pre">~/.clap/configs/instances.yaml</span></code> file. In this way, you need to configure the files only once and launch instances at any time.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node start ubuntu-instance-aws
</pre></div>
</div>
<p>Once instances are successfully started, CLAP will assign an unique node ID to each instance, used to perform other CLAP operation. Also, CLAP will try to login at the instance with the login information provided (via SSH).</p>
<p>To launch more than one instance with the same instance template ID, you can put the desired number after the instance template ID preceded by an <code class="docutils literal notranslate"><span class="pre">:</span></code>. For instance, the command below, launches 4 <code class="docutils literal notranslate"><span class="pre">ubuntu-instance-aws</span></code> instances in a row.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node start ubuntu-instance-aws:4
</pre></div>
</div>
<p>You can also launch different instances in a row using the same command, but just appending more instance template IDs to it, as below. The above command launches 2 <code class="docutils literal notranslate"><span class="pre">ubuntu-instance-aws</span></code> machines and 2 <code class="docutils literal notranslate"><span class="pre">example-instance-aws</span></code> machines in a row.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node start ubuntu-instance-aws:2 example-instance-aws:2
</pre></div>
</div>
</div>
<div class="section" id="command-node-list">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">list</span></code><a class="headerlink" href="#command-node-list" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">list</span></code> command can be used to show managed CLAP nodes. An example output of this command is shown below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*  Node(id=`node-0`, type=`ubuntu-instance-aws`, status=`reachable`, public_ip=`54.152.26.1`, groups=``, tags=``, last_update=`02-05-20 14:48:04`
*  Node(id=`node-1`, type=`example-instance`, status=`reachable`, public_ip=`3.90.153.213`, groups=``, tags=``, last_update=`02-05-20 14:48:04`
Listed 2 node(s)
</pre></div>
</div>
<p>The node id (<code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code> in the above example) is used across all other modules and commands to perform commands in the specific node.</p>
</div>
<div class="section" id="command-node-alive">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">alive</span></code><a class="headerlink" href="#command-node-alive" title="Permalink to this headline">¶</a></h3>
<p>After the node is started, you can check if it is alive using the command <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">alive</span></code>. The command has the following sintax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node alive [-h] [--tag TAG] [node_ids [node_ids ...]]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command to check their aliveness. If no node id is supplied, all CLAP nodes is checked for their aliveness. Optionally you can filter nodes based in their tags (see <a class="reference internal" href="#tags-section"><span class="std std-ref">tags section</span></a>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">alive</span></code> command also updates the node status. Thus, each node can have the following status:</p>
<ul class="simple">
<li><p><strong>started</strong>:  when the cloud’s instance is successfully launched</p></li>
<li><p><strong>reachable</strong>: when the SSH login was successfully performed</p></li>
<li><p><strong>unreachable</strong>: when the login was not successfully performed</p></li>
<li><p><strong>paused</strong>: when node is paused</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">alive</span></code> command also updates the node connection IP and can be very useful when the node IP changes (e.g. and stopped node comes alive or when using floating IPs). As CLAP is an ad-hoc tool and does not monitor each node, its recommended to run this command periodically to update nodes information.</p>
</div>
</div>
<div class="section" id="command-node-show">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">show</span></code><a class="headerlink" href="#command-node-show" title="Permalink to this headline">¶</a></h3>
<p>For more detailed information of a CLAP node, you can use the <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">show</span></code> command, which have the sintax showed bellow. The node id is the unique ID associated to each CLAP node when it is started.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node show [-h] [--tag TAG] [node_ids [node_ids ...]]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command to show information. If no node id is supplied, all CLAP nodes is shown. Optionally you can filter nodes based in their tags (see <a class="reference internal" href="#tags-section"><span class="std std-ref">tags section</span></a>).</p>
</div>
<div class="section" id="command-node-stop">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">stop</span></code><a class="headerlink" href="#command-node-stop" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">stop</span></code> command can be used to <strong>terminate</strong> an running instance (destroying it). The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node stop  [-h] [--tag TAG] node_ids [node_ids ...]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command to stop them. Optionally you can filter nodes based in their tags (see <a class="reference internal" href="#tags-section"><span class="std std-ref">tags section</span></a>).</p>
</div>
<div class="section" id="command-node-pause">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">pause</span></code><a class="headerlink" href="#command-node-pause" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">pause</span></code> command can be used to <strong>pause</strong> an running instance. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node pause [-h] [--tag TAG] node_ids [node_ids ...]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command to pause them. Optionally you can filter nodes based in their tags (see <a class="reference internal" href="#tags-section"><span class="std std-ref">tags section</span></a>).
When a node is paused, it state is changed to <strong>paused</strong> and it’s public IP is changed to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The command has no effect for nodes that already been paused.</p>
</div>
</div>
<div class="section" id="command-node-resume">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">resume</span></code><a class="headerlink" href="#command-node-resume" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">resume</span></code> command can be used to <strong>resume</strong> an paused instance. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node resume [-h] [--tag TAG] node_ids [node_ids ...]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command to resume them. Optionally you can filter nodes based in their tags (see <a class="reference internal" href="#tags-section"><span class="std std-ref">tags section</span></a>).
When a node is resumed, it state is changed to <strong>started</strong>. Then, it checked if it is alive, testing its connection and updating its public I (changing its state to <strong>reachable</strong>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The command has no effect for nodes have not been paused, it will only check for its aliveness.</p>
</div>
</div>
<div class="section" id="command-node-connect">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">connect</span></code><a class="headerlink" href="#command-node-connect" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">connect</span></code> command can be used to obtain a shell to a specific node. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node connect [-h] node_id
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The connection may fail if node has an invalid public IP or a invalid login information. You may want to check if node is alive firstto update node’s information.</p>
</div>
</div>
<div class="section" id="command-node-execute">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">execute</span></code><a class="headerlink" href="#command-node-execute" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">execute</span></code> command can be used to execute a shell command on an reachable node. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node execute [-h] [--tag TAG] --command command [node_ids [node_ids ...]]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command to execute the provided command in all of them. Optionally you can filter nodes based in their tags (see <a class="reference internal" href="#tags-section"><span class="std std-ref">tags section</span></a>).
The <code class="docutils literal notranslate"><span class="pre">--command</span></code> parameter specify the command that will be executed in nodes. An example is shwon below, executing a simple <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lha</span></code> command in nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node execute --command &quot;ls -lha&quot; node-0 node-1
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nodes that cannot be reachable will be ignored. You may want to check for nodes aliveness first.</p>
</div>
</div>
<div class="section" id="command-node-playbook">
<h3>Command <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">playbook</span></code><a class="headerlink" href="#command-node-playbook" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">node</span> <span class="pre">playbook</span></code> command can be used to execute an Ansible playbook in a set of reachable nodes. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node playbook [-h] [--tag TAG] [--extra ...] playbook_file [node_ids [node_ids ...]]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command in order to execute the playbook in all of them. Optionally you can filter nodes based in their tags (see <a class="reference internal" href="#tags-section"><span class="std std-ref">tags section</span></a>). The playbook file must be a valid playbook file and the extra parameter is used if you want to pass keyword values to your playbook, and must be passed in the <code class="docutils literal notranslate"><span class="pre">key=value</span></code> format.</p>
<p>An example is shwon below. The playbook <code class="docutils literal notranslate"><span class="pre">playbook.yml</span></code> is executed in nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code>. Extra playbook variables (jinja format, e.g. “{{ var1 }}”) will be replaced by the extra variables informed. In the example below the playbook’s variable <code class="docutils literal notranslate"><span class="pre">var1</span></code> will be replaced by <code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">of</span> <span class="pre">var</span> <span class="pre">1</span></code> and the playbook’s variable <code class="docutils literal notranslate"><span class="pre">anothervar</span></code> will be replaced by <code class="docutils literal notranslate"><span class="pre">10</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp node playbook  playbook.yml node-0 node-1 --extra &quot;var1=value of var 1&quot; &quot;anothervar= 10&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>For this command, the <code class="docutils literal notranslate"><span class="pre">extra</span></code> paramter <strong>must be the last</strong> parameter.</p></li>
<li><p>The Ansible playbook must use <strong>hosts: all</strong> as all select CLAP nodes will be put in the inventory as a single host. To specify different hosts in you playbook use the <a class="reference internal" href="#group-section"><span class="std std-ref">group command</span></a>, described in later sections.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="tags-module">
<span id="tags-section"></span><h2>Tags Module<a class="headerlink" href="#tags-module" title="Permalink to this headline">¶</a></h2>
<p>The tags module provides mechanisms to add and remove tags at CLAP’s nodes. Tags are efficient ways to select CLAP nodes. For instance, several comamands from <code class="docutils literal notranslate"><span class="pre">node</span></code> module has support to select nodes to limit to nodes which it will actuate.
A tag is just a key (string) which have its list of values (list of strings), thus you can have multiple values for same key.</p>
<div class="section" id="command-tag-add">
<h3>Command <code class="docutils literal notranslate"><span class="pre">tag</span> <span class="pre">add</span></code><a class="headerlink" href="#command-tag-add" title="Permalink to this headline">¶</a></h3>
<p>This <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">tag</span> <span class="pre">add</span></code> command adds a tag to a set of nodes and has the following sintax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp tag add [-h] tag node_ids [node_ids ...]
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">tag</span></code> parameter must be a keyword value in the format <code class="docutils literal notranslate"><span class="pre">key=value</span></code>. You can add as many tags to a node as you want. If you add more than one tag with same key, the values are appended to the key. An example of adding tags is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp tag add x=y node-0 node-1
</pre></div>
</div>
<p>Where tag <code class="docutils literal notranslate"><span class="pre">x=y</span></code> is added to nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code>. If you add another tag, <code class="docutils literal notranslate"><span class="pre">x=z</span></code> to same nodes, for instance, each node will have tags: <code class="docutils literal notranslate"><span class="pre">x=y,z</span></code>.</p>
</div>
<div class="section" id="command-tag-remove">
<h3>Command <code class="docutils literal notranslate"><span class="pre">tag</span> <span class="pre">remove</span></code><a class="headerlink" href="#command-tag-remove" title="Permalink to this headline">¶</a></h3>
<p>This <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">tag</span> <span class="pre">remove</span></code> command removes a tag from a set of nodes and has the following sintax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp tag remove [-h] tag node_ids [node_ids ...]
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">tag</span></code> is a keyword value, such as <code class="docutils literal notranslate"><span class="pre">x=y</span></code>, the value <code class="docutils literal notranslate"><span class="pre">y</span></code> will be removed from tag <code class="docutils literal notranslate"><span class="pre">x</span></code> from the speficied nodes. If the <code class="docutils literal notranslate"><span class="pre">tag</span></code> keyword is not a keyword value, such as simply <code class="docutils literal notranslate"><span class="pre">x</span></code>, all values from tag <code class="docutils literal notranslate"><span class="pre">x</span></code> will be removed (and also the tag <code class="docutils literal notranslate"><span class="pre">x</span></code>) from specified nodes.</p>
</div>
</div>
<div class="section" id="group-module">
<span id="group-section"></span><h2>Group Module<a class="headerlink" href="#group-module" title="Permalink to this headline">¶</a></h2>
<p>The group module allows to perform pre-defined actions to a set of nodes that belongs to a group. When a node is added to a group, it is said that this node plays a role in that group.
Thus, each group defines their set of specific actions that can be performed to nodes that belongs to that particular group.</p>
<p>In this way, the group module consists of three steps:</p>
<ol class="arabic simple">
<li><p>Add nodes to a group.</p></li>
<li><p>Perform group’s action to nodes that belongs to a group.</p></li>
<li><p>Optionally, remove nodes from the group.</p></li>
</ol>
<div class="section" id="clap-s-groups-and-actions">
<h3>CLAP’s groups and actions<a class="headerlink" href="#clap-s-groups-and-actions" title="Permalink to this headline">¶</a></h3>
<p>Group’s actions are <a class="reference external" href="https://www.ansible.com/">Ansible playbooks</a> that are executed when an action is invoked (using <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">action</span></code> command, described below). By default CLAP’s groups are stored in the <code class="docutils literal notranslate"><span class="pre">~/.clap/groups/</span></code> directory and each group consists in at minimum of two files: (1) a YAML description file describing the actions that can be performed (and informing the playbook that must be called) and, optionally the hosts (subset of group’s nodes to execute the playbook) ; (2) the Ansible Playbook called when each action is invoked.
You can see some groups shared with CLAP and their requirements at <a class="reference internal" href="shared_groups.html#shared-groups"><span class="std std-ref">Groups shared with CLAP</span></a> section.</p>
<div class="section" id="group-description-file">
<h4>Group description file<a class="headerlink" href="#group-description-file" title="Permalink to this headline">¶</a></h4>
<p>The group’s description files are python files placed at <code class="docutils literal notranslate"><span class="pre">~/.clap/groups/actions.d</span></code> directory. The name of the YAML file defines the group’s name.
Each group description file defines the key <code class="docutils literal notranslate"><span class="pre">actions</span></code> and (optionally) the <code class="docutils literal notranslate"><span class="pre">hosts</span></code> key. Inside <code class="docutils literal notranslate"><span class="pre">actions</span></code> key, each dictionary defines an CLAP’s action where the key name is the action name and the values informs characteristic of that action, such as which Ansible Playbook to run, an optional description and the variables needed.</p>
<p>An example group description file is shown below, for a group named <code class="docutils literal notranslate"><span class="pre">commands-common</span></code> (at <code class="docutils literal notranslate"><span class="pre">~/.clap/groups/actions.d/commands-common.yml</span></code>).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">actions</span><span class="p">:</span>                    <span class="c1"># Defines the actions of this group</span>
    <span class="nt">setup</span><span class="p">:</span>                  <span class="c1"># Action called setup</span>
        <span class="nt">playbook</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">roles/commands-common_setup.yml</span>   <span class="c1"># Playbook to be executed when this group action is invoked</span>

    <span class="nt">copy</span><span class="p">:</span>                   <span class="c1"># Action called copy</span>
        <span class="nt">playbook</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">roles/commands-common_copy.yml</span>    <span class="c1"># Playbook to be executed when this group action is invoked</span>
        <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Copy files from localhost to remote hosts</span> <span class="c1"># Optional action&#39;s description</span>
        <span class="nt">vars</span><span class="p">:</span>                                       <span class="c1"># Optional variables required</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src</span>                                 <span class="c1"># src variable</span>
          <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Source files/directory to be copied</span> <span class="c1"># optional variable&#39;s description</span>
          <span class="nt">optional</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>                              <span class="c1"># Informs if this variable is optional</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dest</span>                                <span class="c1"># dest variable</span>
          <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Destination directory where files will be placed</span> <span class="c1"># optional variable&#39;s description</span>

    <span class="nt">fetch</span><span class="p">:</span>
        <span class="nt">playbook</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">roles/commands-common_fetch.yml</span>
        <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Fetch files from remote hosts to localhosts</span>
        <span class="nt">vars</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src</span>
          <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Source files/directory to be fetched</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dest</span>
          <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Destination directory where files will be placed</span>

<span class="nt">hosts</span><span class="p">:</span>                      <span class="c1"># (optional) List of hosts that are used in this group (and in the playbooks)</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">slave</span>
</pre></div>
</div>
<p>Fot group’s description files, <code class="docutils literal notranslate"><span class="pre">actions</span></code> dictionary is required, and <code class="docutils literal notranslate"><span class="pre">hosts</span></code> optional. The keys inside <code class="docutils literal notranslate"><span class="pre">actions</span></code> dictionary are the action names and the possible values for each action are described in table below.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Valid values for actions</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">playbook</span></code></p></td>
<td><p>path</p></td>
<td><p>Playbook to be executed when this action is invoked. The path is relative to <code class="docutils literal notranslate"><span class="pre">~/.clap/groups/</span></code> directory.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">description</span></code> (optional)</p></td>
<td><p>string</p></td>
<td><p>Action’s descriptive information</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vars</span></code> (optional)</p></td>
<td><p>List of variable dictionaries</p></td>
<td><p>List informing variables needed for this action</p></td>
</tr>
</tbody>
</table>
<p>And optionally, the actions can define their variables to use. The possible values are listed table below</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Valid action’s values</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p>string</p></td>
<td><p>Name of the variable</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">description</span></code> (optional)</p></td>
<td><p>string</p></td>
<td><p>Variable’s descriptive information</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">optional</span></code> (optional)</p></td>
<td><p>boolean</p></td>
<td><p>Inform if variable is optional (default is <code class="docutils literal notranslate"><span class="pre">no</span></code>)</p></td>
</tr>
</tbody>
</table>
<p>Finally the hosts specify the <code class="docutils literal notranslate"><span class="pre">hosts</span></code> used by group actions. It’s optional and when specified Ansible playbooks can segment their execution using the <code class="docutils literal notranslate"><span class="pre">hosts</span></code> variable at each play. If no hosts are specified use <code class="docutils literal notranslate"><span class="pre">hosts:</span> <span class="pre">all</span></code>  to perform the action over all nodes that belong to the group.</p>
</div>
</div>
<div class="section" id="command-group-list">
<h3>Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">list</span></code><a class="headerlink" href="#command-group-list" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">group</span> <span class="pre">list</span></code> command can be used to list all available groups and their respective actions and hosts. An example of output is shown below, for a group called <code class="docutils literal notranslate"><span class="pre">spits</span></code>, which has actions <code class="docutils literal notranslate"><span class="pre">add-nodes</span></code>, <code class="docutils literal notranslate"><span class="pre">job-copy</span></code>, <code class="docutils literal notranslate"><span class="pre">job-create</span></code>, <code class="docutils literal notranslate"><span class="pre">setup</span></code> and <code class="docutils literal notranslate"><span class="pre">start</span></code>. Besides that, the nodes from this group can be segmented in <code class="docutils literal notranslate"><span class="pre">jobmanager</span></code> and <code class="docutils literal notranslate"><span class="pre">taskmanager</span></code> hosts.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>* GROUP: commands-common
    hosts: none

    &gt; action: setup
        playbook: roles/commands-common_setup.yml

    &gt; action: copy
        playbook: roles/commands-common_copy.yml
        variables:
        - name: src
          description: Source files/directory to be copied
          optional: False
        - name: dest
          description: Destination directory where files will be placed
          optional: False

    &gt; action: fetch
        description: Fetch files from remote hosts to localhosts
        playbook: roles/commands-common_fetch.yml
        variables:
        - name: src
          description: Source files/directory to be fetched
          optional: False
        - name: dest
          description: Destination directory where files will be placed
          optional: False

Listed 1 group(s)
</pre></div>
</div>
</div>
<div class="section" id="command-group-add">
<h3>Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">add</span></code><a class="headerlink" href="#command-group-add" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">group</span> <span class="pre">add</span></code> command can be used to execute add a node to a group. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp group add [-h] [--tag TAG] [--extra ...] group [node_ids [node_ids ...]]
</pre></div>
</div>
<p>One or more node ids can be supplied to the command in order to add all of them to the group. Optionally you can filter nodes to add to the group based in their tags. Some group’s actions may require some additional variables to be passed to the playbook (similar to Ansible’s extra parameter). Additional keyword variables can be passed via <code class="docutils literal notranslate"><span class="pre">extra</span></code> parameter.</p>
<p>For instance, the command below, adds nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code> to group <code class="docutils literal notranslate"><span class="pre">example</span></code> and pass the variables <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code>, with values <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code>, respectively, to the <code class="docutils literal notranslate"><span class="pre">example</span></code> group’s <code class="docutils literal notranslate"><span class="pre">setup</span></code> action.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp group add example node-0 node-1 --extra &quot;x=y&quot; &quot;a=1&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>When a node is added to a group, the group’s setup action is automatically executed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">extra</span></code> parameter <strong>must be the last</strong> parameter.</p></li>
</ul>
</div>
<p>When a group specify hosts, you can add nodes to a group being a defined host using the <code class="docutils literal notranslate"><span class="pre">/</span></code> succeeded the group’s name. For instance the command below adds the node <code class="docutils literal notranslate"><span class="pre">node-0</span></code> to the group <code class="docutils literal notranslate"><span class="pre">spits</span></code> being a <code class="docutils literal notranslate"><span class="pre">jobmanager</span></code> host.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp group add spits/jobmanager node-0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a group has defined hosts but you do not specify which host of the group the node is being added, then the node will be added to all available hosts of that group.</p>
</div>
</div>
<div class="section" id="command-group-action">
<h3>Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">action</span></code><a class="headerlink" href="#command-group-action" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">group</span> <span class="pre">action</span></code> command can be used to perform an action in all nodes belonging to the group. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp group action [-h] [--nodes NODES [NODES ...]] [--tag TAG] [--extra ...] group_name action_name
</pre></div>
</div>
<p>If no nodes is specified, the group’s action will be performed in all CLAP’s nodes that belongs to the group. You can limit the action to nodes that belongs to the group using the <code class="docutils literal notranslate"><span class="pre">nodes</span></code> parameter (which can be supplied with node ids) or <code class="docutils literal notranslate"><span class="pre">tag</span></code> parameter (which can be supplied with tags). Some examples is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp group action spits start
clapp group action spits/jobmanager start
clapp group action spits start --nodes node-0 node-4 --tags &quot;x=y&quot; --extra &quot;a=1&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>The first example above performs action <code class="docutils literal notranslate"><span class="pre">start``from</span> <span class="pre">group</span> <span class="pre">``spits</span></code> in all CLAP’s nodes belonging to <code class="docutils literal notranslate"><span class="pre">spits</span></code> group.</p></li>
<li><p>The second example above performs action <code class="docutils literal notranslate"><span class="pre">start``from</span> <span class="pre">group</span> <span class="pre">``spits</span></code> in all CLAP’s nodes belonging to <code class="docutils literal notranslate"><span class="pre">spits</span></code> group being <code class="docutils literal notranslate"><span class="pre">jobmanager</span></code> host.</p></li>
<li><p>The third example above performs action <code class="docutils literal notranslate"><span class="pre">start``from</span> <span class="pre">group</span> <span class="pre">``spits</span></code> in CLAP’s nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code>, <code class="docutils literal notranslate"><span class="pre">node-4</span></code> and nodes with <code class="docutils literal notranslate"><span class="pre">x=y</span></code> tag.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When performing a group action, all nodes must belong to the group that the action will be performed (even when filtering nodes). Thus, the <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">add</span></code> command is always required before performing an action.</p>
</div>
</div>
<div class="section" id="command-group-remove">
<h3>Command <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">remove</span></code><a class="headerlink" href="#command-group-remove" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">group</span> <span class="pre">remove</span></code> command removes nodes from a specified group. The sintax is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp group remove [-h] [--extra ...] group node_ids [node_ids ...]
</pre></div>
</div>
<p>Similarly to <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">add</span></code> command, you can the node from being a host from a group using the <code class="docutils literal notranslate"><span class="pre">/</span></code> succeeded by the group name. Some examples is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp group remove spits node-0 node-1
clapp group remove spits/jobmanager node-0
</pre></div>
</div>
<ul class="simple">
<li><p>The first example above, remove <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code> from group <code class="docutils literal notranslate"><span class="pre">spits</span></code></p></li>
<li><p>The second example above, remove <code class="docutils literal notranslate"><span class="pre">node-0</span></code> from being host <code class="docutils literal notranslate"><span class="pre">jobmanager</span></code> at the group <code class="docutils literal notranslate"><span class="pre">spits</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If a group has hosts and no host is specified when removing it from the group, the node is removed from being all hosts that it belongs to that group</p></li>
<li><p>If a group has hosts and the node is removed from all hosts from that group, the node does not belong to the group anymore</p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="shared_groups.html" class="btn btn-neutral float-right" title="Groups shared with CLAP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral float-left" title="Basic Configuration Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Otávio Napoli

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>