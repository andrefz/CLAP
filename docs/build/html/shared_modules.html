

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modules shared with CLAP &mdash; CLoud Application Platform 0.2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Groups shared with CLAP" href="shared_groups.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CLoud Application Platform
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Basic Configuration Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="shared_groups.html">Groups shared with CLAP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modules shared with CLAP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cluster-module">Cluster Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cluster-configuration">Cluster Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-configuration-sections">Setup Configuration Sections</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#groups-key-at-an-setups-configuration">Groups key at an setups configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#actions-key-at-an-setups-configuration">Actions key at an setups configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-configuration-sections">Cluster Configuration Sections</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#controlling-cluster-s-setups-execution-phases">Controlling cluster’s setups execution phases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-cluster-s-setups-optional-keys">Other cluster’s setups optional keys</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-start">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">start</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-setup">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">setup</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-add">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">add</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-add-existing">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">add-existing</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-list">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-alive">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">alive</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-resume">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">resume</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-pause">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">pause</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-stop">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">stop</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-list-templates">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">list-templates</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-update">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">update</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-group">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">group</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-action">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">action</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-connect">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">connect</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-execute">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">execute</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-playbook">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">playbook</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-copy">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">copy</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-cluster-fetch">Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">fetch</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CLoud Application Platform</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Modules shared with CLAP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/shared_modules.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modules-shared-with-clap">
<span id="shared-modules"></span><h1>Modules shared with CLAP<a class="headerlink" href="#modules-shared-with-clap" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cluster-module">
<span id="id1"></span><h2>Cluster Module<a class="headerlink" href="#cluster-module" title="Permalink to this headline">¶</a></h2>
<p>The cluster module allows CLAP to work with cluster, which is a set of CLAP’s nodes tagged with a specific tag. A CLAP’s cluster is created taking as input configuration files, in YAML format, which will create nodes and setup each of them properly. After created, the cluster can be resized (adding or removing nodes), paused, resumed, stopped, among other things.
By default, the CLAP’s cluster module will find configurations inside <code class="docutils literal notranslate"><span class="pre">~/clap/configs/clusters</span></code> directory. At next sections, we will assume that files will be created inside this directory (in <code class="docutils literal notranslate"><span class="pre">.yml</span></code> format).</p>
<p>The next section will guide you to write a cluster configuration and then, module’s commands will be presented.</p>
<div class="section" id="cluster-configuration">
<h3>Cluster Configuration<a class="headerlink" href="#cluster-configuration" title="Permalink to this headline">¶</a></h3>
<p>To create a CLAP’s cluster you will need to write:</p>
<ul class="simple">
<li><p><strong>Setup configuration sections</strong>: which define a series of groups and actions that must be performed.</p></li>
<li><p><strong>Cluster configuration sections</strong>: which define a set of nodes that must be created and the setups that must be performed in each node.</p></li>
</ul>
<p>Setups and cluster section may be written in multiple different files (or at the same file), as CLAP’s cluster modules will read all files (and setups and clusters configurations, respectively) inside the cluster’s directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cluster’s configuration files accepts <a class="reference external" href="https://jinja.palletsprojects.com">Jinja-like variables</a> that can be populated using <code class="docutils literal notranslate"><span class="pre">--extra</span></code> parameters at each cluster’s commands. Any part of the configuration can use Jinja-like variables.</p>
</div>
</div>
<div class="section" id="setup-configuration-sections">
<h3>Setup Configuration Sections<a class="headerlink" href="#setup-configuration-sections" title="Permalink to this headline">¶</a></h3>
<p>Setup configuration sections define a series of groups and/or actions that must be performed cluster’s nodes. An example of a setup configuration section is shown below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup configurations must be declared inside setups key</span>
<span class="nt">setups</span><span class="p">:</span>

    <span class="c1"># This is a setup configuration called setup-common</span>
    <span class="nt">setup-common</span><span class="p">:</span>
        <span class="nt">groups</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">commands-common</span>     <span class="c1"># Add nodes to commands-common group</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example-group</span>       <span class="c1"># Add nodes to example-group group</span>

        <span class="nt">actions</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">action</span>              <span class="c1"># Perform action update-packages from group commands-common at nodes</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update-packages</span>
          <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">commands-common</span>

    <span class="c1"># This is a setup configuration called setup-spits-jobmanager</span>
    <span class="nt">setup-spits-jobmanager</span><span class="p">:</span>
        <span class="nt">groups</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">spits/jobmanager</span>   <span class="c1"># Add nodes to spits/jobmanager group</span>

    <span class="c1"># This is a setup configuration called setup-spits-taskmanager</span>
    <span class="nt">setup-spits-taskmanager</span><span class="p">:</span>
        <span class="nt">groups</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">spits/taskmanager</span>   <span class="c1"># Add nodes to spits/taskmanager group</span>
</pre></div>
</div>
<p>Setup configurations must be written inside <code class="docutils literal notranslate"><span class="pre">setups</span></code> YAML-dictionary. You can define as many setup configurations as you want, even at different files (since inside the <code class="docutils literal notranslate"><span class="pre">setups</span></code> YAML-dictionary), but each one must have a unique name.
Inside the <code class="docutils literal notranslate"><span class="pre">setups</span></code> section, each dictionary represents a setup configuration. The dictionary key (<code class="docutils literal notranslate"><span class="pre">setup-common</span></code>, <code class="docutils literal notranslate"><span class="pre">setup-spits-jobmanager</span></code> and <code class="docutils literal notranslate"><span class="pre">setup-spits-taskmanager</span></code> in above example) represent the setup configuration ID.</p>
<p>Each setup configuration may contain two dictionaries: <code class="docutils literal notranslate"><span class="pre">groups</span></code> and <code class="docutils literal notranslate"><span class="pre">actions</span></code> (both are optional). Both sections, for a setup configuration is described in the next two subsections.</p>
<div class="section" id="groups-key-at-an-setups-configuration">
<h4>Groups key at an setups configuration<a class="headerlink" href="#groups-key-at-an-setups-configuration" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">groups</span></code> section inside a setup configuration tells to add nodes, which perform this setup, to the defined groups. The <code class="docutils literal notranslate"><span class="pre">groups</span></code> section contains a <strong>list</strong> describing each group that the nodes must be added. Also, the groups is always added in the order defined in the list.</p>
<p>Each element of the list must have a <code class="docutils literal notranslate"><span class="pre">name</span></code> key, which describe the name of the group that the node must be added.
For instance, the <code class="docutils literal notranslate"><span class="pre">setup-common</span></code> at above example, defines two groups which nodes that perform this setup must be added: <code class="docutils literal notranslate"><span class="pre">commands-common</span></code> and <code class="docutils literal notranslate"><span class="pre">example-group</span></code> (in this order).</p>
<p>Optionally an <code class="docutils literal notranslate"><span class="pre">extra</span></code> key can be defined by each group, as a dictionary. The key and values is passed as <code class="docutils literal notranslate"><span class="pre">extra</span></code> parameter to the <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">add</span></code> module command.
For instance, the setup below, will add nodes that perform this setup (<code class="docutils literal notranslate"><span class="pre">setup-common-2</span></code>) to group <code class="docutils literal notranslate"><span class="pre">example-group</span></code> passing variables, <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">another_var</span></code> with values <code class="docutils literal notranslate"><span class="pre">bar</span></code> and <code class="docutils literal notranslate"><span class="pre">10</span></code>, respectively.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup configurations must be declared inside setups key</span>
<span class="nt">setups</span><span class="p">:</span>

    <span class="c1"># This is a setup configuration called setup-common</span>
    <span class="nt">setup-common-2</span><span class="p">:</span>
        <span class="nt">groups</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example-group</span>     <span class="c1"># Add nodes to example-group group</span>
          <span class="nt">extra</span><span class="p">:</span>
            <span class="nt">foo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
            <span class="nt">another_var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>
</div>
</div>
<div class="section" id="actions-key-at-an-setups-configuration">
<h4>Actions key at an setups configuration<a class="headerlink" href="#actions-key-at-an-setups-configuration" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">actions</span></code> section inside a setup configuration tells to perform actions at nodes which perform this setup. The <code class="docutils literal notranslate"><span class="pre">actions</span></code> section contains a <strong>list</strong> describing each action that must be performed (in order). Each element of the action list must have a type.
A type may have three values:</p>
<ul class="simple">
<li><p><strong>action</strong>: will perform an group action. Thus, the <code class="docutils literal notranslate"><span class="pre">group</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code> key must be informed. The <code class="docutils literal notranslate"><span class="pre">group</span></code> key will tell the name of the group and the <code class="docutils literal notranslate"><span class="pre">name</span></code> key will tell which action from that group which will be performed. Optionally, an <code class="docutils literal notranslate"><span class="pre">extra</span></code> dictionary can be informed to pass keyword variables to the group’s action.</p></li>
<li><p><strong>playbook</strong>: will execute an Ansible Playbook. Thus, the <code class="docutils literal notranslate"><span class="pre">path</span></code> key must be informed, telling the absolute path of the playbook that will be executed. Optionally an <code class="docutils literal notranslate"><span class="pre">extra</span></code> dictionary can be informed to pass keyword variables to the playbook.</p></li>
<li><p><strong>command</strong>: will execute a shell command. Thus, the <code class="docutils literal notranslate"><span class="pre">command</span></code> key must be informed, telling which shell command must be executed.</p></li>
</ul>
<p>Some action examples are briefly shown below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup configurations must be declared inside setups key</span>
<span class="nt">setups</span><span class="p">:</span>

    <span class="c1"># This is a setup configuration called setup-common. The actions are executed sequentially</span>
    <span class="nt">another-setup-example</span><span class="p">:</span>
        <span class="nt">actions</span><span class="p">:</span>

        <span class="c1"># Perform mount action from group nfs-client, passing the variable mount_path with value /mnt</span>
        <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">action</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mount</span>
          <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nfs-client</span>
          <span class="nt">extra</span><span class="p">:</span>
            <span class="nt">mount_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/mnt</span>

        <span class="c1"># Execute the playbook /home/my-cool-ansible-playbook with an variable foo with value bar</span>
        <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">playbook</span>
          <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/my-cool-ansible-playbook</span>
          <span class="nt">extra</span><span class="p">:</span>
            <span class="nt">foo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>

        <span class="c1"># Execute a shell command: hostname</span>
        <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">command</span>
          <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hostname</span>

        <span class="c1"># Perform reboot action from commands-common group</span>
        <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">action</span>
          <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">commands-common</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reboot</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a setup configuration contains both <code class="docutils literal notranslate"><span class="pre">groups</span></code> and <code class="docutils literal notranslate"><span class="pre">actions</span></code> sections, commands at <code class="docutils literal notranslate"><span class="pre">groups</span></code> section will <strong>always</strong> be executed before <code class="docutils literal notranslate"><span class="pre">actions</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="cluster-configuration-sections">
<h3>Cluster Configuration Sections<a class="headerlink" href="#cluster-configuration-sections" title="Permalink to this headline">¶</a></h3>
<p>The cluster configuration defines a set of nodes that must be created and setups that must be executed. Clusters are written inside <code class="docutils literal notranslate"><span class="pre">clusters</span></code> YAML-dictionary key and each dictionary inside <code class="docutils literal notranslate"><span class="pre">clusters</span></code> key denotes a cluster (where the dictionary key is the cluster’s name). Above is an example of a cluster configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clusters must be defined inside clusters key</span>
<span class="nt">clusters</span><span class="p">:</span>
  <span class="c1"># This is the cluster name</span>
  <span class="nt">my-cool-cluster-1</span><span class="p">:</span>
    <span class="c1"># Nodes that must be created when a cluster is instantiated</span>
    <span class="nt">nodes</span><span class="p">:</span>
      <span class="c1"># Node named master-node</span>
      <span class="nt">master-node</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-instance-t2.large</span>   <span class="c1"># Instance type that must be created (must match instances.yaml name)</span>
        <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>                      <span class="c1"># Number of instances that must be created</span>
        <span class="nt">setups</span><span class="p">:</span>                       <span class="c1"># Optionally, list of setups to be executed when the master-nodes is created (reference setup configuration names, at setups section)</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">another-example-setup</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">master-setup</span>

      <span class="c1"># Node named taskmanager</span>
      <span class="nt">slave-nodes</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-instance-t2.small</span>  <span class="c1"># Instance type that must be created (must match instances.yaml name)</span>
        <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>                     <span class="c1"># Number of instances that must be created</span>
        <span class="nt">min_count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>                 <span class="c1"># Minimum desired number of instances that must effectively be created</span>
        <span class="nt">setups</span><span class="p">:</span>                      <span class="c1"># Optionally, list of setups to be executed when the slave-nodes is created</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">setup-slave-node</span>
</pre></div>
</div>
<p>Clusters must have the <code class="docutils literal notranslate"><span class="pre">nodes</span></code> section, which defines the nodes that must be created when the cluster is instantiated. As example above, each cluster’s node have a name (<code class="docutils literal notranslate"><span class="pre">master-node</span></code> and <code class="docutils literal notranslate"><span class="pre">slave-node</span></code>) and values, that specify the cluster’s node characteristics. Each node may have the values listed in is table below.</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">code-block:: none Cluster’s nodes valid parameters</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>string</p></td>
<td><p>Instance type that must to be created. The type must match the node name at <code class="docutils literal notranslate"><span class="pre">instances.yaml</span></code> file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">count</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p>Number of instances of this type to be launched</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">min_count</span></code> (OPTIONAL)</p></td>
<td><p>Positive integer (less then or equal <code class="docutils literal notranslate"><span class="pre">count</span></code> parameter)</p></td>
<td><p>Minimum number of instances of this type that must effectively be launched. If this parameter is not supplied the value of <code class="docutils literal notranslate"><span class="pre">count</span></code> parameter is assumed</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">setups</span></code></p></td>
<td><p>List of strings</p></td>
<td><p>List with the name of the setup configurations that must be executed after nodes are created</p></td>
</tr>
</tbody>
</table>
<p>When a cluster is created, the instance types specified in the each node section is created with the desired <code class="docutils literal notranslate"><span class="pre">count</span></code> number. The cluster is considered created when all nodes are effectively created. The <code class="docutils literal notranslate"><span class="pre">min_count</span></code> parameter at each node specify the minimum number of instances of that type that must effectively be launched. If some instances could not be instantiated, with less than <code class="docutils literal notranslate"><span class="pre">min_count</span></code> parameter, the cluster creation process fails and all nodes are terminated.</p>
<p>After the cluster is created, i.e. the minimum number of nodes of each type is successfully created, the <code class="docutils literal notranslate"><span class="pre">setups</span></code> for each node is executed, in order. If some setup does not execute correctly, the cluster remains created and the <code class="docutils literal notranslate"><span class="pre">setup</span></code> phase can be executed again.</p>
<div class="section" id="controlling-cluster-s-setups-execution-phases">
<h4>Controlling cluster’s setups execution phases<a class="headerlink" href="#controlling-cluster-s-setups-execution-phases" title="Permalink to this headline">¶</a></h4>
<p>CLAP’s cluster module also offers some other facilities to configure the cluster. By default the cluster module create nodes and run the setup from each node type. You can control the flow of the setup execution using some optional keys at your cluster configuration. The keys: <code class="docutils literal notranslate"><span class="pre">before_all</span></code>, <code class="docutils literal notranslate"><span class="pre">before</span></code>, <code class="docutils literal notranslate"><span class="pre">after</span></code> and <code class="docutils literal notranslate"><span class="pre">after_all</span></code> can be plugged into a cluster’s configuration, in order to execute setups in different set of nodes, before and after the nodes setups. These keys takes a list of setups to execute.
CLAP’s setup phases are executed in the order, as shown in table bellow.</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text">code-block:: none Cluster’s setups execution phases (in order)</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Phase name</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">before_all</span></code></p></td>
<td><p>Setups inside this key are executed in all cluster’s nodes before specific setup of the nodes.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">before</span></code></p></td>
<td><p>Setups inside this key are executed only in nodes that are currently being added to the cluster, before the setup specific setup of the nodes. Its useful when resizing cluster, i.e., adding more nodes. This phase is always executed at cluster creation, as all created nodes are being added to the cluster.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">node</span></code></p></td>
<td><p>The setup for each node is executed. The setup (inventory generated) is excuted only at nodes of this type</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">after</span></code></p></td>
<td><p>Setups inside this key are executed only in nodes that are currently being added to the cluster, after the setup specific setup of the nodes. Its useful when resizing cluster, i.e., adding more nodes. This phase is always executed at cluster creation, as all created nodes are being added to the cluster.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">after_all</span></code></p></td>
<td><p>Setups inside this key are executed in all cluster’s nodes after specific setup of the nodes.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All setups are optional</p>
</div>
<p>An example is shown below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clusters must be defined inside clusters key</span>
<span class="nt">clusters</span><span class="p">:</span>
  <span class="c1"># This is the cluster name</span>
  <span class="nt">my-cool-cluster-1</span><span class="p">:</span>
    <span class="c1"># These setups are executed at all cluster&#39;s nodes, before setups at nodes section</span>
    <span class="nt">before_all</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my-custom-setup-1</span>

    <span class="c1"># These setups are executed at nodes that are currently being added to cluster, before setups at nodes section</span>
    <span class="nt">before</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my-custom-setup-2</span>

    <span class="c1"># These setups are executed at nodes that are currently being added to cluster, after setups at nodes section</span>
    <span class="nt">after</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my-custom-setup-3</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my-custom-setup-4</span>

    <span class="c1"># These setups are executed at all cluster&#39;s nodes, after setups at nodes section</span>
    <span class="nt">after_all</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">final_setup</span>

    <span class="c1"># Nodes that must be created when a cluster is instantiated</span>
    <span class="nt">nodes</span><span class="p">:</span>
      <span class="c1"># Node named master-node</span>
      <span class="nt">master-node</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-instance-t2.large</span>   <span class="c1"># Instance type that must be created (must match instances.yaml name)</span>
        <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>                      <span class="c1"># Number of instances that must be created</span>
        <span class="nt">setups</span><span class="p">:</span>                       <span class="c1"># Optionally, list of setups to be executed when the master-nodes is created (reference setup configuration names, at setups section)</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">another-example-setup</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">master-setup</span>

      <span class="c1"># Node named taskmanager</span>
      <span class="nt">slave-nodes</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-instance-t2.small</span>  <span class="c1"># Instance type that must be created (must match instances.yaml name)</span>
        <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>                     <span class="c1"># Number of instances that must be created</span>
        <span class="nt">min_count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>                 <span class="c1"># Minimum desired number of instances that must effectively be created</span>
        <span class="nt">setups</span><span class="p">:</span>                      <span class="c1"># Optionally, list of setups to be executed when the slave-nodes is created</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">setup-slave-node</span>
</pre></div>
</div>
<p>In the above example, supposing you are creating a new cluster, thus after 1 <code class="docutils literal notranslate"><span class="pre">master-node</span></code> and 2 <code class="docutils literal notranslate"><span class="pre">slave-nodes</span></code> were created, the following setups are executed (in order):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">before_all</span></code> setups: <code class="docutils literal notranslate"><span class="pre">my-custom-setup-1</span></code> at all nodes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">before</span></code> setups: <code class="docutils literal notranslate"><span class="pre">my-custom-setup-2</span></code> at all nodes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nodes</span></code> setups (not necessary in order): <code class="docutils literal notranslate"><span class="pre">another-example-setup</span></code> and <code class="docutils literal notranslate"><span class="pre">master-setup</span></code> at <code class="docutils literal notranslate"><span class="pre">master-nodes</span></code> nodes and <code class="docutils literal notranslate"><span class="pre">setup-slave-node</span></code> at <code class="docutils literal notranslate"><span class="pre">slave-nodes</span></code> nodes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">after</span></code> setups: <code class="docutils literal notranslate"><span class="pre">my-custom-setup-3</span></code> and <code class="docutils literal notranslate"><span class="pre">my-custom-setup-4</span></code> at all nodes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">after_all</span></code> setups: <code class="docutils literal notranslate"><span class="pre">final_setup</span></code> at all nodes</p></li>
</ul>
<p>Now supposing you are resizing the already created cluster (adding more <code class="docutils literal notranslate"><span class="pre">slave-nodes</span></code> to it), the <code class="docutils literal notranslate"><span class="pre">before_all</span></code> and <code class="docutils literal notranslate"><span class="pre">after_all</span></code> setups will be executed in all cluster’s nodes (including the new ones, that are being added) and <code class="docutils literal notranslate"><span class="pre">before</span></code>, <code class="docutils literal notranslate"><span class="pre">nodes</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code> phase setups will only be executed at nodes that are being added to the the cluster.</p>
</div>
<div class="section" id="other-cluster-s-setups-optional-keys">
<h4>Other cluster’s setups optional keys<a class="headerlink" href="#other-cluster-s-setups-optional-keys" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> key can be plugged at a cluster configuration allowing some special options to cluster. The <code class="docutils literal notranslate"><span class="pre">options</span></code> key may have the following parameters:</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">code-block:: none Cluster’s options keys</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option name</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ssh_to</span></code></p></td>
<td><p>Connect to a specific node when performing the <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">connect</span></code> command</p></td>
</tr>
</tbody>
</table>
<p>A example is shown below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clusters must be defined inside clusters key</span>
<span class="nt">clusters</span><span class="p">:</span>
  <span class="c1"># This is the cluster name</span>
  <span class="nt">my-cool-cluster-1</span><span class="p">:</span>
    <span class="c1"># Additional cluster&#39;s options (optional)</span>
    <span class="nt">options</span><span class="p">:</span>
      <span class="c1"># When connecting to a cluster, connect to a master-node</span>
      <span class="nt">ssh_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">master-node</span>

    <span class="c1"># Nodes that must be created when a cluster is instantiated</span>
    <span class="nt">nodes</span><span class="p">:</span>
      <span class="c1"># Node named master-node</span>
      <span class="nt">master-node</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-instance-t2.large</span>   <span class="c1"># Instance type that must be created (must match instances.yaml name)</span>
        <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>                      <span class="c1"># Number of instances that must be created</span>
        <span class="nt">setups</span><span class="p">:</span>                       <span class="c1"># Optionally, list of setups to be executed when the master-nodes is created (reference setup configuration names, at setups section)</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">another-example-setup</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">master-setup</span>

      <span class="c1"># Node named taskmanager</span>
      <span class="nt">slave-nodes</span><span class="p">:</span>
        <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-instance-t2.small</span>  <span class="c1"># Instance type that must be created (must match instances.yaml name)</span>
        <span class="nt">count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>                     <span class="c1"># Number of instances that must be created</span>
        <span class="nt">min_count</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>                 <span class="c1"># Minimum desired number of instances that must effectively be created</span>
        <span class="nt">setups</span><span class="p">:</span>                      <span class="c1"># Optionally, list of setups to be executed when the slave-nodes is created</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">setup-slave-node</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="command-cluster-start">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">start</span></code><a class="headerlink" href="#command-cluster-start" title="Permalink to this headline">¶</a></h3>
<p>Start a cluster given a cluster configuration name. The syntax of the command is shown below</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster start [-h] [--file FILE] [--directory DIRECTORY] [--no-setup] [--extra ...] cluster_name
</pre></div>
</div>
<p>By default, the CLAP’s cluster module search for configurations at all <code class="docutils literal notranslate"><span class="pre">.yml</span></code> files inside <code class="docutils literal notranslate"><span class="pre">~/.clap/configs/clusters</span></code> directory. This can be changed with <code class="docutils literal notranslate"><span class="pre">--directory</span></code> parameter. Or if you want to search for the cluster configuration at only one file, use the <code class="docutils literal notranslate"><span class="pre">--file</span></code> parameter.
After the cluster is created, the setups are automatically executed. You can omit this phase by using the <code class="docutils literal notranslate"><span class="pre">--no-setup</span></code> option.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--extra</span></code> parameter performs Jinja variable replacements at the cluster configuration files.</p>
<p>An example of the command is shown below, which starts and instantiate nodes from a cluster called <code class="docutils literal notranslate"><span class="pre">my-cool-cluster-1</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster start my-cool-cluster-1
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>After the cluster’s creation a new <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> will be assigned to it. Thus, multiple clusters with same cluster configuration can be launched Also, all commands will reference to <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> to perform their actions.</p></li>
<li><p>When a cluster is started its initial configuration is copied to cluster metadata. If you update the cluster configuration while having already started clusters use the <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">cluster</span> <span class="pre">update</span></code> command to update the cluster configuration.</p></li>
</ul>
</div>
</div>
<div class="section" id="command-cluster-setup">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">setup</span></code><a class="headerlink" href="#command-cluster-setup" title="Permalink to this headline">¶</a></h3>
<p>Setup an existing cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster setup [-h] [--readd-group] [--nodes NODES] [--at [AT]] cluster_id
</pre></div>
</div>
<p>Given the <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code>, the command will execute all setup phases in all cluster nodes. Some phases of the setup pipeline can be skipped informing at which phase the setup must begin with the <code class="docutils literal notranslate"><span class="pre">at</span></code> parameter. Also, if you want to execute the setup only in selected nodes of the cluster you can use the <code class="docutils literal notranslate"><span class="pre">nodes</span></code> parameter, passing the node ids. Finally, the <code class="docutils literal notranslate"><span class="pre">readd-group</span></code> option specify if nodes must be added to a group, even if they are already on them.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster setup cluster-0
clapp cluster setup cluster-0 --at &quot;before&quot;
clapp cluster setup cluster-0 --nodes node-4 node-5
</pre></div>
</div>
<p>In the above examples, the first one setups all cluster nodes from <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code>, the second one setups all nodes, but starting at <code class="docutils literal notranslate"><span class="pre">before</span></code> phase and the third one setup only <code class="docutils literal notranslate"><span class="pre">node-4</span></code> and <code class="docutils literal notranslate"><span class="pre">node-5</span></code> of cluster <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">before_all</span></code> and <code class="docutils literal notranslate"><span class="pre">after_all</span></code> phases will be executed at all cluster’s nodes, even if setting the <code class="docutils literal notranslate"><span class="pre">nodes</span></code> parameter.</p>
</div>
</div>
<div class="section" id="command-cluster-add">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">add</span></code><a class="headerlink" href="#command-cluster-add" title="Permalink to this headline">¶</a></h3>
<p>Start and add a new node to cluster, based on its cluster’s node name. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster add [-h] [--readd-group] [--at [AT]] [--no-setup] cluster_id node_type:num [node_type:num ...]
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">node_type:num</span></code> parameter determines how much nodes will be added to cluster. If <code class="docutils literal notranslate"><span class="pre">--no-setup</span></code> is provided no setup phase will be executed, else the setup phase to be executed can be controlled with <code class="docutils literal notranslate"><span class="pre">--at</span></code> parameter. Finally, the <code class="docutils literal notranslate"><span class="pre">readd-group</span></code> option specify if nodes must be added to a group, even if they are already on them.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster add cluster-0 slave-nodes:2
</pre></div>
</div>
<p>In the above example, two <code class="docutils literal notranslate"><span class="pre">slave-nodes</span></code> will be added to cluster <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code> and all setup phases will be executed.</p>
</div>
<div class="section" id="command-cluster-add-existing">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">add-existing</span></code><a class="headerlink" href="#command-cluster-add-existing" title="Permalink to this headline">¶</a></h3>
<p>Add an already started CLAP’s node to a cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster add-existing [-h] [--readd-group] [--at [AT]] [--no-setup] cluster_id node_type node_ids [node_ids ...]
</pre></div>
</div>
<p>The command allow to add multiple started nodes by its node IDs (<code class="docutils literal notranslate"><span class="pre">node_ids</span></code> parameter) to a already started cluster. The nodes will be added as the cluster’s node type, defined by <code class="docutils literal notranslate"><span class="pre">node_type</span></code> parameter If <code class="docutils literal notranslate"><span class="pre">--no-setup</span></code> is provided no setup phase will be executed, else the setup phase to be executed can be controlled with <code class="docutils literal notranslate"><span class="pre">--at</span></code> parameter. Finally, the <code class="docutils literal notranslate"><span class="pre">readd-group</span></code> option specify if nodes must be added to a group, even if they are already on them.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster add-existing cluster-0 slave-nodes node-0 node-1 node-2
</pre></div>
</div>
<p>In the above example, nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code>, <code class="docutils literal notranslate"><span class="pre">node-1</span></code> and <code class="docutils literal notranslate"><span class="pre">node-2</span></code>  will be added to cluster <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code> as <code class="docutils literal notranslate"><span class="pre">slave-nodes</span></code> cluster’s node type and all setup phases will be executed.</p>
</div>
<div class="section" id="command-cluster-list">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">list</span></code><a class="headerlink" href="#command-cluster-list" title="Permalink to this headline">¶</a></h3>
<p>List all available CLAP’s clusters. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster list [-h] [--id ID] [--full]
</pre></div>
</div>
<p>Optionally, if <code class="docutils literal notranslate"><span class="pre">--id</span></code> parameter is passed, only a cluster with this ID is listed. Also, if <code class="docutils literal notranslate"><span class="pre">--full</span></code> parameter is passed it will print all cluster information, including it’s configuration used.</p>
<p>An output example is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>creation time: 01-01-20 00:00:00
id: cluster-0
name: my-cool-cluster-1
nodes:
    master-node:
    - node-0
    slave-node:
    - node-1
    - node-2
state: running
update time: 01-15-20 00:01:40
</pre></div>
</div>
</div>
<div class="section" id="command-cluster-alive">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">alive</span></code><a class="headerlink" href="#command-cluster-alive" title="Permalink to this headline">¶</a></h3>
<p>Check if all nodes of the cluster are alive. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster alive [-h] cluster_id
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">clapp</span> <span class="pre">cluster</span> <span class="pre">alive</span></code> command also updates the nodes connection’s IP and can be very useful when node’s IP changes (e.g. and stopped node comes alive or when using floating IPs). As CLAP is an ad-hoc tool and does not monitor each node, its recommended to run this command periodically to update nodes information.</p>
</div>
</div>
<div class="section" id="command-cluster-resume">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">resume</span></code><a class="headerlink" href="#command-cluster-resume" title="Permalink to this headline">¶</a></h3>
<p>Resume all nodes of the cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster resume [-h] [--setup] [--at [AT]] cluster_id
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> all nodes in the cluster will be resumed. If option <code class="docutils literal notranslate"><span class="pre">setup</span></code> is set, it also runs setups in nodes. The <code class="docutils literal notranslate"><span class="pre">at</span></code> parameter controls the setup phase.</p>
</div>
<div class="section" id="command-cluster-pause">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">pause</span></code><a class="headerlink" href="#command-cluster-pause" title="Permalink to this headline">¶</a></h3>
<p>Pause all nodes of the cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster pause [-h] cluster_id
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> all nodes in the cluster will be paused.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a node belongs to more than one cluster, it will only be paused if all clusters that contains this node is paused.</p>
</div>
</div>
<div class="section" id="command-cluster-stop">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">stop</span></code><a class="headerlink" href="#command-cluster-stop" title="Permalink to this headline">¶</a></h3>
<p>Stop all nodes of the cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster stop [-h] cluster_id
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> all nodes in the cluster will be stopped.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a node belongs to more than one cluster, it will only be stopped if all clusters that contains this node are stopped. Else, the node is just removed from the cluster.</p>
</div>
</div>
<div class="section" id="command-cluster-list-templates">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">list-templates</span></code><a class="headerlink" href="#command-cluster-list-templates" title="Permalink to this headline">¶</a></h3>
<p>List all available cluster templates at directory. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster list-templates [-h] [--file FILE] [--directory DIRECTORY]
</pre></div>
</div>
<p>All clusters at <code class="docutils literal notranslate"><span class="pre">~/clap/configs/clusters</span></code> directory will be listed. A different directory can be specified with <code class="docutils literal notranslate"><span class="pre">--directory</span></code> parameter. If the <code class="docutils literal notranslate"><span class="pre">--file</span></code> parameter is passed, clusters will only be listed from this file.</p>
</div>
<div class="section" id="command-cluster-update">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">update</span></code><a class="headerlink" href="#command-cluster-update" title="Permalink to this headline">¶</a></h3>
<p>Update a cluster configuration from a created cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster update [-h] [--file FILE] [--directory DIRECTORY] [--extra ...] cluster_id
</pre></div>
</div>
<p>By default, the cluster’s configuration and its name is stored when a cluster is created. If you update configurations files, you can update a running cluster’s configuration using this command (note, the cluster configuration name must not change).</p>
<p>Clusters will be searched at <code class="docutils literal notranslate"><span class="pre">~/clap/configs/clusters</span></code> directory. A different directory can be specified with <code class="docutils literal notranslate"><span class="pre">--directory</span></code> parameter. If the <code class="docutils literal notranslate"><span class="pre">--file</span></code> parameter is passed, clusters will only be listed from this file. Finally <code class="docutils literal notranslate"><span class="pre">--extra</span></code> parameter is used to perform Jinja replacements.</p>
</div>
<div class="section" id="command-cluster-group">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">group</span></code><a class="headerlink" href="#command-cluster-group" title="Permalink to this headline">¶</a></h3>
<p>Add cluster’s nodes to a group. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster group [-h] [--nodes NODES [NODES ...]] [--readd-group] [--extra ...] cluster_id group
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code>, adds all nodes belonging to this cluster to the group, informed by <code class="docutils literal notranslate"><span class="pre">group</span></code> parameter. If the <code class="docutils literal notranslate"><span class="pre">--readd-group</span></code> option is set nodes will be added to a group, even if they are already on them. Nodes of cluster can be filtered using the <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> parameter. Finally, the <code class="docutils literal notranslate"><span class="pre">--extra</span></code> parameter pass keyword variables to the group’s setup action.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster group cluster-0 commands-common
clapp cluster group cluster-0 commands-common --nodes node-0 node-1
clapp cluster group cluster-0 commands-common --nodes node-0 node-1 --extra &quot;foo=bar&quot;
</pre></div>
</div>
<p>In the above examples, the first one adds all nodes from <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code> to the group <code class="docutils literal notranslate"><span class="pre">commands-common</span></code>. The second one, added only nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code> from <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code> to the group <code class="docutils literal notranslate"><span class="pre">commands-common</span></code>. The third one is similar to the second one but pass the variable <code class="docutils literal notranslate"><span class="pre">foo</span></code> with value <code class="docutils literal notranslate"><span class="pre">bar</span></code> to the <code class="docutils literal notranslate"><span class="pre">commands-common</span> <span class="pre">setup</span></code> action.</p>
</div>
<div class="section" id="command-cluster-action">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">action</span></code><a class="headerlink" href="#command-cluster-action" title="Permalink to this headline">¶</a></h3>
<p>Perform a group action to cluster’s nodes. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster action [-h] [--nodes NODES [NODES ...]] [--extra ...] cluster_id group action
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code>, it will perform a group action, informed by <code class="docutils literal notranslate"><span class="pre">group</span></code> and <code class="docutils literal notranslate"><span class="pre">action</span></code> parameters, to all nodes of the cluster. Nodes of cluster can be filtered using the <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> parameter. Finally, the <code class="docutils literal notranslate"><span class="pre">--extra</span></code> parameter pass keyword variables to the group’s action.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster action cluster-0 commands-common update-packages
clapp cluster action cluster-0 commands-common update-packages --nodes node-0 node-1
clapp cluster action cluster-0 commands-common update-packages --nodes node-0 node-1 --extra &quot;foo=bar&quot;
</pre></div>
</div>
<p>In the above examples, the first one adds perform the <code class="docutils literal notranslate"><span class="pre">update-packages</span></code> action from <code class="docutils literal notranslate"><span class="pre">commands-common</span></code> group at all nodes of cluster <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code>. The second one, perform the <code class="docutils literal notranslate"><span class="pre">update-packages</span></code> action from <code class="docutils literal notranslate"><span class="pre">commands-common</span></code> group only at nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code> from <code class="docutils literal notranslate"><span class="pre">cluster-0`.</span> <span class="pre">The</span> <span class="pre">third</span> <span class="pre">one</span> <span class="pre">is</span> <span class="pre">similar</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">second</span> <span class="pre">one</span> <span class="pre">but</span> <span class="pre">pass</span> <span class="pre">the</span> <span class="pre">variable</span> <span class="pre">``foo</span></code> with value <code class="docutils literal notranslate"><span class="pre">bar</span></code> to the <code class="docutils literal notranslate"><span class="pre">commands-common</span> <span class="pre">update-packages</span></code> action.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The action is performed only in nodes of cluster that belongs to the specified group</p>
</div>
</div>
<div class="section" id="command-cluster-connect">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">connect</span></code><a class="headerlink" href="#command-cluster-connect" title="Permalink to this headline">¶</a></h3>
<p>Get a SSH shell to a node of the cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster connect [-h] [--node NODE] cluster_id
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> it will try to get an SSH shell to a node type specified in <code class="docutils literal notranslate"><span class="pre">ssh_to</span></code> cluster configuration option. If no <code class="docutils literal notranslate"><span class="pre">ssh_to</span></code> option is informed at cluster’s configuration the <code class="docutils literal notranslate"><span class="pre">--node</span></code> parameter must be informed. If the <code class="docutils literal notranslate"><span class="pre">--node</span></code> parameter is informed an SSH shell from that node will be get.</p>
</div>
<div class="section" id="command-cluster-execute">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">execute</span></code><a class="headerlink" href="#command-cluster-execute" title="Permalink to this headline">¶</a></h3>
<p>Execute a shell command in nodes of the cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster execute [-h] [--nodes NODES [NODES ...]] --command COMMAND cluster_id
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> execute the string command passed from <code class="docutils literal notranslate"><span class="pre">command</span></code> parameter in cluster’s nodes. The <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> parameters can be populated with the cluster’s nodes ids to limit the execution of the command to these nodes.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster execute --command &quot;ls -lha&quot; cluster-0
clapp cluster execute --command &quot;ls -lha&quot; cluster-0 --nodes node-0 node-1
</pre></div>
</div>
<p>In the above examples, the first one execute the command <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-lha</span></code> in all cluster <code class="docutils literal notranslate"><span class="pre">cluster-0</span></code> nodes. The second ne is similar to the first, but execute the command in nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code> only.</p>
</div>
<div class="section" id="command-cluster-playbook">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">playbook</span></code><a class="headerlink" href="#command-cluster-playbook" title="Permalink to this headline">¶</a></h3>
<p>Execute an Ansible Playbook in nodes of the cluster. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster playbook [-h] [--nodes NODES [NODES ...]] [--extra ...] cluster_id playbook_file
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code>, the Ansible playbook located at the informed parameter <code class="docutils literal notranslate"><span class="pre">playbook_file</span></code> is executed. The <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> parameters can be populated with the cluster’s nodes ids to limit the execution of the playbook to these nodes. Finally, the <code class="docutils literal notranslate"><span class="pre">--extra</span></code> parameter pass keyword variables to the playbook.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster playbook cluster-0 /home/my-playbook.yml
clapp cluster playbook cluster-0 /home/my-playbook.yml --nodes node-0 node-1
clapp cluster playbook cluster-0 /home/my-playbook.yml --nodes node-0 node-1 --extra &quot;foo=bar&quot; &quot;var1=abaco&quot;
</pre></div>
</div>
<p>In the above examples, the first one execute the playbook <code class="docutils literal notranslate"><span class="pre">/home/my-playbook.yml</span></code> at all cluster’s nodes. The second one also execute the <code class="docutils literal notranslate"><span class="pre">/home/my-playbook.yml</span></code> playbook, but limiting to nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> and <code class="docutils literal notranslate"><span class="pre">node-1</span></code> only. The third one is similar to the second, but also pass the extra variables <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">var1</span></code> with values <code class="docutils literal notranslate"><span class="pre">bar</span></code> and <code class="docutils literal notranslate"><span class="pre">abaco</span></code> (respectively) to the playbook.</p>
</div>
<div class="section" id="command-cluster-copy">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">copy</span></code><a class="headerlink" href="#command-cluster-copy" title="Permalink to this headline">¶</a></h3>
<p>Copy files from the localhost to all cluster’s nodes. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster copy [-h] [--nodes NODES [NODES ...]] cluster_id from dest
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code>, the files informed at <code class="docutils literal notranslate"><span class="pre">from</span></code> parameter are all copied (recursively) from localhost to the <code class="docutils literal notranslate"><span class="pre">dest</span></code> directory at all nodes.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster copy cluster-0 /home/my-file &quot;{{ ansible_env.HOME }}/my-folder&quot;
clapp cluster copy cluster-0 /home/my-directory/ &quot;{{ ansible_env.HOME }}/my-folder&quot; --nodes node-0
</pre></div>
</div>
<p>In the above examples, the first one will copy the file at <code class="docutils literal notranslate"><span class="pre">/home/my-file</span></code> (from localhost) to nodes <code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">ansible_env.HOME</span> <span class="pre">}}/my-folder&quot;</span></code> directory (see notes below). The second one will copy the  directory at  <code class="docutils literal notranslate"><span class="pre">/home/my-directory/</span></code> (from localhost) to node’s <code class="docutils literal notranslate"><span class="pre">node-0</span></code> <code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">ansible_env.HOME</span> <span class="pre">}}/my-folder&quot;</span></code> directory (see notes below).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Use the value <code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">ansible_env.HOME</span> <span class="pre">}}&quot;</span></code> as a special variable to access a node’s user home directory.</p></li>
<li><p>The command uses the <a class="reference external" href="https://rsync.samba.org/">rsync copy format</a> to select files to copy.</p></li>
</ul>
</div>
</div>
<div class="section" id="command-cluster-fetch">
<h3>Command <code class="docutils literal notranslate"><span class="pre">cluster</span> <span class="pre">fetch</span></code><a class="headerlink" href="#command-cluster-fetch" title="Permalink to this headline">¶</a></h3>
<p>Fetch files from remote nodes to localhost. The command has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster fetch [-h] [--nodes NODES [NODES ...]] cluster_id from dest
</pre></div>
</div>
<p>Given a <code class="docutils literal notranslate"><span class="pre">cluster_id</span></code>, the files informed at <code class="docutils literal notranslate"><span class="pre">from</span></code> parameter are all copied (recursively) from the cluster’s nodes to the <code class="docutils literal notranslate"><span class="pre">dest</span></code> directory at localhost.</p>
<p>Examples are shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clapp cluster fetch cluster-0 &quot;{{ ansible_env.HOME }}/my-file&quot; /home/my-directory
clapp cluster fetch cluster-0 &quot;{{ ansible_env.HOME }}/my-folder&quot; /home/my-directory/ --nodes node-0
</pre></div>
</div>
<p>In the above examples, the first one will fetch the file at <code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">ansible_env.HOME</span> <span class="pre">}}/my-folder&quot;</span></code> from cluster’s nodes (see notes below) to the localhost’s <code class="docutils literal notranslate"><span class="pre">/home/my-directory&quot;</span></code> directory. The second one will fetch the  directory at <code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">ansible_env.HOME</span> <span class="pre">}}/my-folder&quot;</span></code> from cluster’s nodes <code class="docutils literal notranslate"><span class="pre">node-0</span></code> (see notes below) to the localhost’s <code class="docutils literal notranslate"><span class="pre">/home/my-directory&quot;</span></code> directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Use the value <code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">ansible_env.HOME</span> <span class="pre">}}&quot;</span></code> as a special variable to access a node’s user home directory.</p></li>
<li><p>The command uses the <a class="reference external" href="https://rsync.samba.org/">rsync copy format</a> to select files to fetch.</p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="shared_groups.html" class="btn btn-neutral float-left" title="Groups shared with CLAP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Otávio Napoli

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>